<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Feedback Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: rgb(220,240,255);
            color: rgb(10,55,95);
            padding: 20px;
            font-size: 14px;
        }
        .form-inline .form-group {
            display: inline-block;
            margin-right: 15px;
        }
        .form-inline label {
            margin-right: 5px;
        }
        .form-check-label-left {
        margin-right: 10px;
        font-size: 14px;
        width: 140px; /* Set a fixed width */
        text-align: center; /* Center align text within the label */
        display: inline-block; /* Ensures consistent spacing */
        }
        .form-check-label-right {
        margin-right: 10px;
        font-size: 14px;
        width: 122px; /* Set a fixed width */
        text-align: center; /* Center align text within the label */
        display: inline-block; /* Ensures consistent spacing */
        }
        .list-group-item h4 {
            font-size: 16px;
        }
        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
        }
        .slider-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }
    
        .slider {
            width: 75%;
            margin: 0 10px;
            -webkit-appearance: none;
            appearance: none;
            background: none;
        }
    
        /* Style for the slider track */
        .slider::-webkit-slider-runnable-track {
            height: 6px;
            background: rgb(150, 150, 150); /* Adjust to desired darker grey tone */
            border-radius: 3px;
        }
        .slider::-moz-range-track {
            height: 6px;
            background: rgb(150, 150, 150); /* For Firefox */
            border-radius: 3px;
        }
        .slider::-ms-track {
            height: 6px;
            background: rgb(150, 150, 150); /* For IE */
            border-radius: 3px;
        }
    
        /* Style for the slider thumb */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: rgb(10, 55, 95);
            border-radius: 50%;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: rgb(10, 55, 95);
            border-radius: 50%;
            cursor: pointer;
        }
        .slider::-ms-thumb {
            width: 15px;
            height: 15px;
            background: rgb(10, 55, 95);
            border-radius: 50%;
            cursor: pointer;
        }
    
        .numerical-scale {
            position: relative;
            width: 75%;
            margin: 10px auto;
            height: 20px;
        }
    
        .numerical-scale div {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            height: 20px;
        }
    
        .numerical-scale span {
            position: absolute;
            transform: translateX(-50%);
        }
    
        .numerical-scale span:nth-child(1) { left: 3%; }
        .numerical-scale span:nth-child(2) { left: 19%; }
        .numerical-scale span:nth-child(3) { left: 35%; }
        .numerical-scale span:nth-child(4) { left: 51%; }
        .numerical-scale span:nth-child(5) { left: 67%; }
        .numerical-scale span:nth-child(6) { left: 83%; }
        .numerical-scale span:nth-child(7) { left: 99%; }

    /* Input, select, and textarea styles */
    input[type="text"], input[type="number"], select, textarea {
        border: 2px solid rgb(150, 150, 150); /* Match slider's darker grey tone */
        border-radius: 4px;
        background-color: #f8f9fa;
        padding: 8px;
        font-size: 14px;
        width: auto;
        box-shadow: none; /* Override Bootstrap's box shadow */
    }

    /* Apply consistent padding and alignment for select elements */
    select {
        padding: 8px; /* Ensure consistent padding */
        background-color: #f8f9fa; /* Light grey background */
        border: 2px solid rgb(150, 150, 150); /* Match slider's border color */
        border-radius: 4px; /* Rounded corners */
        appearance: none; /* Remove default dropdown styling */
        width: auto; /* Flexible width */
        background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23969696' d='M2 0L0 2h4z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 10px;
    }

    textarea {
        resize: vertical; /* Allow vertical resizing only */
    }

    /* Focus styles */
    input:focus, select:focus, textarea:focus {
        border-color: rgb(120, 120, 120); /* Slightly darker border on focus */
        outline: none;
        box-shadow: 0 0 5px rgba(120, 120, 120, 0.5); /* Subtle focus shadow */
    }
    .form-control,
    .form-select {
        background-color: rgb(320, 320, 320); /* Match the darker grey tone */
        border: 2px solid rgb(150, 150, 150); /* Darker grey for borders */
        color: rgb(10, 55, 95); /* Match text color */
        border-radius: 5px; /* Optional: rounded corners */
        padding: 5px 10px; /* Adjust padding for consistent spacing */
        font-size: 14px; /* Consistent font size */
    }
    </style>
    
</head>
<body>


    <div class=container>
        <h2 id=title1>Mortgage Broker AI Assistance</h2>
    </div>
    
    <div id="question_area" class="container">
        <h1 style="text-align:center; color:rgb(10,55,95);">Feedback Form</h1>
        <p style="font-size:20px; text-align:center;">
            Finally, we would like to gather some feedback about your experience and perceptions in the last 25 tasks. Thank you!
        </p>

    <!-- User Information Section -->
    <div class="card my-3">
        <div class="card-header" style="background-color:rgb(10,55,95); color:white;">
            <h3>Your Information (Optional)</h3>
        </div>
        <div class="card-body">
            <form id="form_info" class="form-inline">
                <div class="form-group">
                    <label for="id">Participant ID:</label>
                    <input type="text" id="id" name="id" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="age">Age:</label>
                    <input type="number" id="age" name="age" class="form-control" min="10" max="90" required>
                </div>
                <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" name="gender" class="form-select" required>
                        <option value="" selected disabled>Select</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>Prefer no to say</option>
                        <option>Others</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="experience">AI Knowledge:</label>
                    <select id="experience" name="experience" class="form-select" required>
                        <option value="" selected disabled>Select</option>
                        <option>Expert in AI</option>
                        <option>Know/Used AI algorithms</option>
                        <option>Basic AI concepts</option>
                        <option>No AI knowledge</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

     <!-- Post-Task Questionnaire -->
     <div class="card my-3">
        <div class="card-header" style="background-color:rgb(10,55,95); color:white;">
            <h3>Post-Task Questionnaire (Required)</h3>
        </div>
        <div class="card-body">
            <form id="post-task-questionnaire">
                <ul class="list-group list-group-flush">
                    <!-- Question Template -->
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q1. How easy was it to choose which clients to accept.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Very Easy</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q1">
                            <label class="form-check-label-right">Very Hard</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q2. I was confident during the decision-making process.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q2">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q3. The AI recommendations helped me to make better decisions.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q3">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q4. I trusted the recommendations of the AI textbot.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q4">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q5. I trusted the recommendations of the AI videobot.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q5">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q6. Which AI was more accurate in its recommendations?</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Videobot</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q6">
                            <label class="form-check-label-right">Textbot</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q7. I would like to use AI to make decisions in the future.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q7">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item" style="position: relative;">
                        <h4>Q8. I felt pressure to make the right decision.</h4>
                        <div class="slider-container">
                            <label class="form-check-label-left">Strongly Disagree</label>
                            <input type="range" class="form-range slider" min="1" max="7" step="1" id="Q8">
                            <label class="form-check-label-right">Strongly Agree</label>
                        </div>
                        <!-- Numerical Scale -->
                        <div class="numerical-scale">
                            <div>
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
                            </div>
                        </div>
                    </li>                    
                </ul>
            </form>
        </div>
    </div>

    <!-- Submit Button -->
    <div style="text-align:center;margin-top:30px;">
        <!-- <button id="submitFeedback" class="btn btn-primary btn-lg" 
          onclick="window.location.href='https://vancuvrboy.github.io/CPEN541/final.htm';"> -->
        <!-- when the button is clicked it fetched participantId and total_score from the querystring and appends them to the url 'https://vancuvrboy.github.io/CPEN541/final.htm' -->
        <button id="submitFeedback" class="btn btn-primary btn-lg"
            onclick="storeCompletedTaskData(); window.location.href='https://vancuvrboy.github.io/CPEN541/final.htm?participantId=' + participantId + '&total_score=' + total_score;">
            Submit & Go to Leaderboard
        </button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let participantId;
    let total_score;


    
    // Function to extract query parameters
    function getQueryParameter(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // function to store the completed task data in google sheets
    function storeCompletedTaskData() {
                // Extract the values from the form
                const age = document.getElementById("age").value;
                const gender = document.getElementById("gender").value;
                const klai = document.getElementById("experience").value;
                const Q1 = document.getElementById("Q1").value;
                const Q2 = document.getElementById("Q2").value;
                const Q3 = document.getElementById("Q3").value;
                const Q4 = document.getElementById("Q4").value;
                const Q5 = document.getElementById("Q5").value;
                const Q6 = document.getElementById("Q6").value;
                const Q7 = document.getElementById("Q7").value;

                // Construct the URL for the Google Apps Script
                const scriptUrl = "https://script.google.com/macros/s/AKfycbyX6EXj-GAsdqOPRhjF5hCTFZZtbqi_OD4AY9yJsn5Vt1kUzqOoczPbXMMhAAhtIMwmrg/exec";

                // Assemble Query String entries as strings based on post pending next_challenge to the variable names
                let qs1 = `?age=${age}`;
                let qs2 = `&gender=${gender}`;
                let qs3 = `&klai=${klai}`;
                let qs4 = `&Q1=${Q1}`;
                let qs5 = `&Q2=${Q2}`;
                let qs6 = `&Q3=${Q3}`;
                let qs7 = `&Q4=${Q4}`;
                let qs8 = `&Q5=${Q5}`;
                let qs9 = `&Q6=${Q6}`;
                let qs10 = `&Q7=${Q7}`;
                let qs11 = `&participantId=${participantId}`;
                
                let queryString = qs1 + qs2 + qs3 + qs4 + qs5 + qs6 + qs7 + qs8 + qs9 + qs10 + qs11;
                console.log("queryString: ", queryString);   

                // Send a GET request to the Google Apps Script
                fetch(scriptUrl + queryString, {
                    method: 'GET',
                })
                    .then((result) => result.text())
                    .then((text) => {
                        console.log('Server Response:', text);
                        alert('Task data submitted successfully!');
                    })
                    .catch((error) => {
                        console.error('Error submitting task data:', error);
                        alert('An error occurred. Please try again.');
                    });
            }

    // Prepopulate Participant ID field
    document.addEventListener("DOMContentLoaded", function () {
        participantId = getQueryParameter("participantId") || "P1234";
        total_score = getQueryParameter("total_score") || 0;

        const participantField = document.getElementById("id");



        if (participantId) {
            participantField.value = participantId; // Set the value from the query string
            console.log("Participant ID found in the query string:", participantId);
        } else {
            console.error("Participant ID not found in the query string.");
            participantField.value = "Unknown"; // Default fallback value if the query parameter is missing
        }

        participantField.readOnly = true; // Make the field readonly
    });
</script>
</body>
</html>
